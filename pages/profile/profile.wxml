<navigation-bar title="我的" back="{{false}}" color="#000000" background="#ffffff"></navigation-bar>

<!-- User Info Section (Full Width) -->
<view class="user-card">
  <view class="avatar-wrapper">
    <image class="avatar" src="{{(user && user.profile && user.profile.avatar_url) || 'https://mmbiz.qpic.cn/mmbiz/icTdbqWNOwNRna42FI242Lcia07jQodd2FJGIYQfG0LAJGFxM4FbnQP6yfMxBgJ0F3YRqJCJ1aPAK2dQagdusBZg/0'}}" mode="aspectFill"></image>
  </view>
  <view class="info-wrapper">
    <view class="nickname">{{(user && user.profile && user.profile.nickname) || '未授权用户'}}</view>
    <view class="user-id" wx:if="{{user && user.id}}">ID: {{user.id}}</view>
    <button class="auth-btn" wx:if="{{!user}}" bindtap="onAuthorizeTap" loading="{{isLoading}}">去授权</button>
  </view>
</view>

<view class="profile-container">
  <view class="stats-card" wx:if="{{user}}">
    <view class="stat-item">
      <view class="stat-num">{{postsCount}}</view>
      <view class="stat-label">发布</view>
    </view>
    <view class="stat-split"></view>
    <view class="stat-item">
      <view class="stat-num">{{participationsCount}}</view>
      <view class="stat-label">参团</view>
    </view>
  </view>

  <view class="section" wx:if="{{user}}">
    <view class="section-title">我发布的拼团</view>
    <view wx:if="{{publishedList.length === 0}}" class="empty-text">暂无发布记录</view>
    <view wx:else class="goods-list">
      <goods-card wx:for="{{publishedList}}" wx:key="id" item="{{item}}" bind:buy="onGoodsTap"></goods-card>
    </view>
  </view>

  <view class="section" wx:if="{{user}}">
    <view class="section-title">我参与的拼团</view>
    <view wx:if="{{participatedList.length === 0}}" class="empty-text">暂无参团记录</view>
    <view wx:else class="goods-list">
      <goods-card wx:for="{{participatedList}}" wx:key="id" item="{{item}}" bind:buy="onGoodsTap"></goods-card>
    </view>
  </view>
</view>
