<navigation-bar title="发布拼团" back="{{false}}" color="#000" background="#fff"></navigation-bar>

<view class="publish-container">
  <view class="tabs-header">
    <block wx:for="{{tabs}}" wx:key="*this">
      <view class="tab-item {{activeTab === index ? 'active' : ''}}" bindtap="onTabClick" data-index="{{index}}">
        <text class="tab-text">{{item}}</text>
        <view class="tab-line" wx:if="{{activeTab === index}}"></view>
      </view>
    </block>
  </view>

  <view class="tips-section">
    <view class="tutorial-link">
      <text>分享教程</text>
      <view class="help-icon">?</view>
    </view>
    <view class="tip-content">
      先在首页搜索已发布团，如果可以以直接拼，无需再发布，成团速度更快！
    </view>
  </view>

  <view class="upload-section" bindtap="onUploadImage">
    <block wx:if="{{uploadedImage}}">
      <image class="preview-image" src="{{uploadedImage}}" mode="aspectFit"></image>
      <view class="re-upload-text">点击重新上传</view>
    </block>
    <block wx:else>
      <view class="upload-placeholder">
        <text class="plus-icon">+</text>
        <text class="upload-text">上传拼团图片</text>
      </view>
    </block>
  </view>

  <view class="qr-result-section" wx:if="{{uploadedImage}}">
    <view class="status-list">
      <view class="status-row">
        <text class="status-label">上传图片</text>
        <text class="status-mark" wx:if="{{uploadedImage}}">✔</text>
      </view>
      <view class="status-row">
        <text class="status-label">识别拼团信息</text>
        <text class="status-mark" wx:if="{{recognizeState === 'success'}}">✔</text>
        <text class="status-mark status-processing" wx:elif="{{recognizeState === 'processing'}}">…</text>
        <text class="status-mark status-failed" wx:elif="{{recognizeState === 'failed' || recognizeState === 'duplicate'}}">!</text>
      </view>
      <view class="status-hint" wx:if="{{recognizeHint}}">{{recognizeHint}}</view>
    </view>

    <view class="qr-actions">
      <view class="qr-action-btn" bindtap="onRecognizeQr">重新识别</view>
      <view class="qr-action-btn" wx:if="{{orderLink === '' && qrStatus !== 'scanning'}}" bindtap="onRecognizeQrByScanCode">使用扫一扫</view>
    </view>
  </view>

  <canvas canvas-id="qrCanvas" class="qr-canvas" style="width:{{canvasW}}px;height:{{canvasH}}px;" width="{{canvasW}}" height="{{canvasH}}"></canvas>

  <!--view class="options-section">
    <text class="options-label">置顶拼团</text>
    <view class="options-group">
      <block wx:for="{{topOptions}}" wx:key="value">
        <view class="option-item" bindtap="onOptionSelect" data-value="{{item.value}}">
          <view class="checkbox {{selectedTopOption === item.value ? 'checked' : ''}}">
            <text wx:if="{{selectedTopOption === item.value}}" class="check-mark">✓</text>
          </view>
          <text class="option-text {{selectedTopOption === item.value ? 'active-text' : ''}}">{{item.label}}</text>
        </view>
      </block>
    </view>
  </view-->

  <view class="submit-btn-wrapper">
    <button class="submit-btn" bindtap="onSubmit" disabled="{{!canSubmit}}">发布拼团</button>
  </view>
</view>
